(desc:(eng:"# Speed model\n\nIn the Portal game portals didn\'t move, they can be placed only on stationary surfaces, this is because of physics engine limitations. Therefore people not sure about moving portals behaviour.\n\nIn this scene showed the right answer about how moved portal should behave.\n\nExactly this behaviour is considered right in the [Minute physics](https://www.youtube.com/watch?v=B19nlhbA7-E) video.\n\nIf look at different angles to the animation, then it looks like portal movement is equal to space movement. In one case space and all its objects always moved, in other case space and its objects always stationary for both before and after teleportation.",rus:"# Модель скорости\n\nВ игре Portal порталы не двигались, они размещались только на неподвижных поверхностях, таково было ограничение физического движка. Поэтому люди слабо представляют как должны себя вести двигающиеся порталы.\n\nВ этой сцене показан правильный ответ на вопрос о том как двигающийся портал должен себя вести.\n\nИменно такое поведение считается правильным в [Минутке физики](https://www.youtube.com/watch?v=B19nlhbA7-E).\n\nЕсли рассмотреть разные точки зрения на движение, то кажется как будто движение портала аналогично движению всего пространства. И в одних случаях пространство и объекты внутри него либо всегда подвижны либо всегда неподвижны до или после телепортации."),cam:(look_at:(0,0,0),alpha:-40.21322001026705,beta:1.014499290809047,r:4.2350000000000305,offset_after_material:0.000025),uniforms:(ids:(available:[(11),(12),(13),(14),(15),(16),(17),(18),(19)],max:21),storage:{(0):Named(Float((min:Some(0),max:None,value:4)),"room_size_x"),(1):Named(Float((min:Some(0),max:None,value:4)),"room_size_y"),(2):Named(Float((min:Some(0),max:None,value:6)),"room_size_z"),(3):Inline(Formula(("-room_size_x"))),(4):Inline(Formula(("-room_size_y"))),(5):Inline(Formula(("-room_size_z"))),(6):Inline(Formula(("-2 + progress * 4"))),(7):Named(Bool(true),"teleport_light"),(8):Named(Bool(true),"enable_animation"),(9):Named(Formula(("if(enable_animation, (time * 0.4) % 1, 0.0)")),"progress"),(10):Named(Bool(false),"mirror"),(20):Inline(Formula(("")))},storage_order:[(0),(1),(2),(7),(9),(8),(10)]),matrices:(ids:(available:[(13),(14),(15),(16),(17),(18),(19),(20),(21),(22),(23),(24),(25),(28),(29),(30),(31),(32)],max:37),storage:{(0):Named(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"room_origin"),(1):Inline(Mul(to:Some(((2))),what:Some(((0))))),(2):Inline(Parametrized(offset:(x:Yes(Some(((0)))),y:No(0),z:No(0)),rotate:(x:No(0),y:No(1.5707963267948966),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(3):Inline(Mul(to:Some(((4))),what:Some(((0))))),(4):Inline(Parametrized(offset:(x:Yes(Some(((3)))),y:No(0),z:No(0)),rotate:(x:No(0),y:No(1.5707963267948966),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(5):Inline(Mul(to:Some(((6))),what:Some(((0))))),(6):Inline(Parametrized(offset:(x:No(0),y:Yes(Some(((1)))),z:No(0)),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(7):Inline(Mul(to:Some(((8))),what:Some(((0))))),(8):Inline(Parametrized(offset:(x:No(0),y:Yes(Some(((4)))),z:No(0)),rotate:(x:No(1.5707963267948966),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(9):Inline(Mul(to:Some(((10))),what:Some(((0))))),(10):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((2))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(11):Inline(Mul(to:Some(((12))),what:Some(((0))))),(12):Inline(Parametrized(offset:(x:No(0),y:No(0),z:Yes(Some(((5))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1))),(26):Inline(Mul(to:Some(((27))),what:Some(((13))))),(27):Inline(Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))),(33):Named(Parametrized(offset:(x:No(1),y:No(0),z:Yes(Some(((6))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1)),"portal_a"),(34):Named(Simple(offset:(-2,0,2),scale:1,rotate:(0,0,0),mirror:(false,false,false)),"portal_b"),(35):Named(Simple(offset:(1,0,0.5),scale:1,rotate:(4.71238898038469,0,0),mirror:(false,false,false)),"triangle"),(36):Named(Teleport(first_portal:Some(((33))),second_portal:Some(((34))),what:Some(((35)))),"triangle_teleported")},storage_order:[(0),(33),(34),(35),(36)]),objects:(ids:(available:[(6),(7),(8),(9),(10),(11),(12),(13),(14)],max:18),storage:{(0):Named(Flat(kind:Simple(Some(((1)))),is_inside:(("return is_inside_square(x, y, room_size_z_u, room_size_y_u, room_yellow_M);"))),"room_x+"),(1):Named(Flat(kind:Simple(Some(((3)))),is_inside:(("return is_inside_square(x, y, room_size_z_u, room_size_y_u, room_red_M);"))),"room_x-"),(2):Named(Flat(kind:Simple(Some(((5)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_z_u, room_black_M);"))),"room_y+"),(3):Named(Flat(kind:Simple(Some(((7)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_z_u, room_gray_M);"))),"room_y-"),(4):Named(Flat(kind:Simple(Some(((9)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_y_u, room_blue_M);"))),"room_z+"),(5):Named(Flat(kind:Simple(Some(((11)))),is_inside:(("return is_inside_square(x, y, room_size_x_u, room_size_y_u, room_green_M);"))),"room_z-"),(15):Named(Flat(kind:Portal(Some(((33))),Some(((34)))),is_inside:(("return is_inside_portal(\n  square_distance(x, y), \n  1.0, \n  0.1,\n  0.01,\n  portal_orange_M, \n  portal_blue_M, \n  grid_gray_M, \n  grid_gray_M, \n  back,\n  first\n);"))),"portal"),(16):Named(Flat(kind:Simple(Some(((35)))),is_inside:(("if ((portal_a_mat_inv * pos).z < 0.) return NOT_INSIDE;\n\nreturn is_inside_triangle(x, y, 2.0, 2.0, 0.04, triangle_white_M, triangle_black_M);"))),"triangle"),(17):Named(Flat(kind:Simple(Some(((36)))),is_inside:(("if ((portal_b_mat_inv * pos).z > 0.) return NOT_INSIDE;\n\nreturn is_inside_triangle(x, y, 2.0, 2.0, 0.04, triangle_white_M, triangle_black_M);"))),"triangle_teleported")},storage_order:[(0),(1),(2),(3),(4),(5),(15),(16),(17)]),cameras:(ids:(available:[],max:5),storage:{(0):Inline((look_at:MatrixCenter(Some(((35)))),alpha:-36.13129936492539,beta:1.1405000792741842,r:2.8925619834710936)),(1):Inline((look_at:MatrixCenter(Some(((34)))),alpha:-39.313298959971426,beta:1.0879999861270253,r:4.23500000000003)),(2):Inline((look_at:MatrixCenter(Some(((36)))),alpha:-39.29051584328812,beta:1.0914993984550339,r:4.658500000000034)),(3):Inline((look_at:MatrixCenter(Some(((33)))),alpha:-36.14648789210745,beta:0.7204999859184147,r:4.2350000000000305)),(4):Inline((look_at:Coordinate((0,0,0)),alpha:-40.21322001026705,beta:1.014499290809047,r:4.2350000000000305))},storage_order:[]),textures:(ids:(available:[],max:1),storage:{(0):Named(("scenes/monoportal.png"),"texture")},storage_order:[(0)]),materials:(ids:(available:[(19),(20)],max:22),storage:{(0):Named(Simple(color:(0.7647179,0.7024815,0.061205085),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_yellow"),(1):Named(Simple(color:(0.029196177,0.029196177,0.029196177),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_black"),(2):Named(Simple(color:(0.8458183,0.07454156,0.07454156),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_red"),(3):Named(Simple(color:(0.18068509,0.18068509,0.18068509),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_gray"),(4):Named(Simple(color:(0.116810285,0.26798066,0.9083436),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_blue"),(5):Named(Simple(color:(0.15478948,0.73873776,0.2186588),normal_coef:0.5,grid:true,grid_scale:1,grid_coef:0.3),"room_green"),(6):Named(Simple(color:(0.03529411764705882,0.6431372549019608,0.788235294117647),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"portal_blue"),(7):Named(Simple(color:(0.9294117647058824,0.4235294117647059,0.050980392156862744),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"portal_orange"),(8):Named(Simple(color:(0.6666666666666666,0.6666666666666666,0.6666666666666666),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"grid_gray"),(9):Named(Simple(color:(0.043137254901960784,0.043137254901960784,0.043137254901960784),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"triangle_black"),(10):Named(Simple(color:(0.7686274509803922,0.7686274509803922,0.7686274509803922),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"triangle_white"),(11):Named(Simple(color:(1,0.24313725490196078,0.24313725490196078),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"solid_0"),(12):Named(Simple(color:(0.24313725490196078,1,0.25098039215686274),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"solid_1"),(13):Named(Simple(color:(0.1843137254901961,0.19607843137254902,1),normal_coef:0.5,grid:true,grid_scale:5,grid_coef:0.3),"solid_2"),(14):Named(Simple(color:(1,0.9764705882352941,0.15294117647058825),normal_coef:0.5,grid:true,grid_scale:4,grid_coef:0.3),"solid_3"),(15):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(0.15478948,0.73873776,0.2186588), 5e-1, true, 1.0, 3e-1);\nresult.mul_to_color *= texture(texture_tex, vec2(room_size_x_u + hit.u, room_size_x_u-hit.v) / (room_size_x_u * 2.0)).rgb;\nreturn result;"))),"room_green_texture"),(16):Named(Complex(code:(("MaterialProcessing result = material_simple(hit, r, vec3(1.16810285e-1, 2.6798066e-1, 9.083436e-1), 5e-1, true, 1.0, 3e-1);\nresult.mul_to_color *= texture(texture_tex, vec2(room_size_x_u + hit.u, room_size_x_u-hit.v) / (room_size_x_u * 2.0)).rgb;\nreturn result;"))),"room_blue_texture"),(17):Named(Reflect(add_to_color:(1,1,1)),"mirror"),(18):Named(Simple(color:(0,0,0),normal_coef:0.5,grid:false,grid_scale:4,grid_coef:0.3),"solid_black"),(21):Named(Complex(code:(("if (i.hit.u > 0.) {\n return material_simple(hit, r, vec3(1.16810285e-1, 2.6798066e-1, 9.083436e-1), 5e-1, true, 1e0, 3e-1);\n} else {\n return material_simple(hit, r, vec3(8.458183e-1, 7.454156e-2, 7.454156e-2), 5e-1, true, 1e0, 3e-1);\n}"))),"chamber_red_blue")},storage_order:[(0),(2),(1),(3),(4),(16),(5),(15),(6),(7),(17),(8),(9),(10),(18),(11),(12),(13),(14),(21)]),library:(ids:(available:[],max:4),storage:{(0):Named((("int is_inside_square(float x, float y, float sizex, float sizey, int material) {\n  if (abs(x) < sizex && abs(y) < sizey) {\n    return material;\n  } else {\n    return NOT_INSIDE;\n  }\n}\n")),"room"),(1):Named((("SceneIntersection intersect_box(Ray r, int material) {\nvec3 rad = vec3(4., 4., 4.);\nvec3 m = 1.0/r.d.xyz;\nvec3 n = m*r.o.xyz;\nvec3 k = abs(m)*rad;\nvec3 t1 = -n - k;\nvec3 t2 = -n + k;\n\nfloat tN = max( max( t1.x, t1.y ), t1.z );\nfloat tF = min( min( t2.x, t2.y ), t2.z );\n\nfloat t = tN;\nif (tN < 0.0 && tF > 0.0) t = tF;\n\nif(tN > tF) return scene_intersection_none;\n\nif(t < 0.0) return scene_intersection_none;\n\nvec3 oN = -sign(r.d.xyz)*step(t1.yzx,t1.xyz)*step(t1.zxy,t1.xyz);\n\nvec3 pos = (r.o + r.d * t).xyz;\n\nvec2 uv = vec2(pos.x, pos.y);\nif (abs(abs(pos.x) - rad.x) < 0.0001) {\n  uv = vec2(pos.y, pos.z);\n}\nif (abs(abs(pos.y) - rad.y) < 0.0001) {\n  uv = vec2(pos.x, pos.z);\n}\n\nreturn SceneIntersection(material, SurfaceIntersection(true, t, uv.x, uv.y, normalize_normal(r.d.xyz, oN)));\n}")),"box"),(2):Named((("int is_inside_triangle(float x, float y, float angle, float width, float border, int inner_m, int border_m) {\n  float value = width * 0.7 - abs(x)*angle;\n  if (between(border, y, value - border * angle)) {\n    return inner_m;\n  } else if (between(0., y, value)) {\n    return border_m;\n  } else {\n    return NOT_INSIDE;\n  }\n}")),"triangle"),(3):Named((("float circle_distance(float x, float y) {\n  return sqrt(sqr(x) + sqr(y));\n}\n\nfloat ellipse_distance(float x, float y) {\n  return sqrt(2.*sqr(x) + sqr(y));\n}\n\nfloat square_distance(float x, float y) {\n  return max(abs(x), abs(y));\n}\n\nfloat rect_distance(float x, float y) {\n  return max(abs(x), abs(y) - 1.);\n}\n\nint is_inside_portal(\n  float distance, \n  float size, \n  float border,\n  float black_border,\n  int material_first, \n  int material_second, \n  int grid_material_first, \n  int grid_material_second, \n  bool back,\n  bool first\n) {\n  int material = material_second;\n  if (first) { material = material_first; }\n\n  if (distance < size) {\n    if (back) {\n      return material;      \n    } else {\n      if (teleport_light_u == 1) {\n      \tif (mirror_u == 1) {\n          return mirror_M;\n        } else {\n          return TELEPORT;\n        }\n      } else {\n        if (first) {\n          return grid_material_first;\n        } else {\n          return grid_material_second;\n        }\n      }\n    }\n  }\n  int black_material = solid_black_M;\n  if (_black_border_disable == 1) black_material = material;\n  if (distance < size + black_border && !back) return black_material;\n  if (distance < size + black_border + border) return material;\n  if (distance < size + black_border + border + black_border) return black_material;\n\n  return NOT_INSIDE;\n}")),"portal")},storage_order:[(0),(1),(2),(3)]),animations_filters:(uniforms:({((8)):true,((7)):true,((2)):false,((9)):false,((0)):false,((1)):false,((10)):true,((6)):true}),matrices:({((36)):false,((31)):false,((0)):false,((34)):false,((33)):false,((52)):false,((13)):false,((35)):false,((32)):false}),cameras:({((0)):false,((1)):true,((3)):false,((2)):true})),elements_descriptions:(uniforms:({((6)):(help_description:None,overrided_name:""),((10)):(help_description:None,overrided_name:"Distance"),((7)):(help_description:None,overrided_name:"Teleport light"),((9)):(help_description:None,overrided_name:"Progress"),((8)):(help_description:None,overrided_name:"Enable animation")}),matrices:({((33)):(help_description:None,overrided_name:"Blue portal"),((35)):(help_description:None,overrided_name:"Triangle"),((34)):(help_description:None,overrided_name:"Orange portal")}),cameras:({((2)):(help_description:None,overrided_name:"Blue world"),((1)):(help_description:None,overrided_name:"Red world")})),user_uniforms:(uniforms:({((8)):true,((0)):false,((2)):false,((1)):false,((10)):false,((7)):true,((9)):false,((6)):false}),matrices:({((36)):false,((0)):false,((32)):false,((33)):false,((34)):false,((31)):false,((13)):false,((35)):false,((52)):false})),animation_stages:(ids:(available:[],max:5),storage:{(0):Named((name:(eng:"Look at stationary triangle",rus:"Смотрим на неподвижный треугольник"),description:Some((eng:"Before and after teleportation triangle looks like it is stationary.",rus:"Как до телепортации, так и после телепортации, треугольник с этой точки зрения остаётся неподвижным.")),uniforms:({((0)):FromDev,((7)):FromDev,((9)):FromDev,((1)):FromDev,((8)):FromDev,((2)):FromDev}),matrices:({((36)):FromDev,((0)):FromDev,((35)):FromDev,((33)):FromDev,((34)):FromDev}),original_cam_button:false,set_cam:Some(Some(((0)))),cams:{}),"look into blue"),(1):Named((name:(eng:"Look at orange portal",rus:"Смотрим на оранжевый портал"),description:Some((eng:"Similarly for the orange portal: space inside always move, therefore triangle move too after teleportation.",rus:"Аналогично для оранжевого портала: пространство внутри него непрерывно движется.")),uniforms:({((8)):FromDev,((2)):FromDev,((9)):FromDev,((7)):FromDev,((0)):FromDev,((1)):FromDev}),matrices:({((35)):FromDev,((36)):FromDev,((33)):FromDev,((34)):FromDev,((0)):FromDev}),original_cam_button:false,set_cam:Some(Some(((1)))),cams:{}),"look into orange"),(2):Named((name:(eng:"Look at moved triangle",rus:"Смотрим на двигающийся треугольник"),description:Some((eng:"Similarly triangle looks like it always move.",rus:"Тут аналогично треугольник всегда движется.")),uniforms:({((1)):FromDev,((2)):FromDev,((0)):FromDev,((7)):FromDev,((8)):FromDev,((9)):FromDev}),matrices:({((0)):FromDev,((34)):FromDev,((33)):FromDev,((36)):FromDev,((35)):FromDev}),original_cam_button:false,set_cam:Some(Some(((2)))),cams:{}),"look at moved triangle"),(3):Named((name:(eng:"Look at blue portal",rus:"Смотрим на синий портал"),description:Some((eng:"For blue portal it looks like space is moved, therefore no wonder that after teleportation triangle is continue to move.",rus:"Для синего портала кажется как будто всё пространство вокруг движется, поэтому неудивительно что после телепортации треугольник продолжает двигаться.")),uniforms:({((2)):FromDev,((0)):FromDev,((9)):FromDev,((7)):FromDev,((8)):FromDev,((1)):FromDev}),matrices:({((35)):FromDev,((36)):FromDev,((0)):FromDev,((33)):FromDev,((34)):FromDev}),original_cam_button:false,set_cam:Some(Some(((3)))),cams:{}),"Look into blue portal"),(4):Named((name:(eng:"Original camera",rus:"Оригинальная камера"),description:None,uniforms:({((8)):FromDev,((7)):FromDev,((1)):FromDev,((2)):FromDev,((0)):FromDev,((9)):FromDev}),matrices:({((34)):FromDev,((35)):FromDev,((36)):FromDev,((0)):FromDev,((33)):FromDev}),original_cam_button:false,set_cam:Some(Some(((4)))),cams:{}),"look at center")},storage_order:[(4),(3),(1),(0),(2)]),current_stage:Some(((4))),dev_stage:(uniforms:({((8)):Bool(true),((9)):Formula(("if(enable_animation, (time * 0.4) % 1, 0.0)")),((10)):Bool(false),((1)):Float((min:Some(0),max:None,value:4)),((7)):Bool(true),((0)):Float((min:Some(0),max:None,value:4)),((2)):Float((min:Some(0),max:None,value:6))}),matrices:({((36)):Teleport(first_portal:Some(((33))),second_portal:Some(((34))),what:Some(((35)))),((33)):Parametrized(offset:(x:No(1),y:No(0),z:Yes(Some(((6))))),rotate:(x:No(0),y:No(0),z:No(0)),mirror:(x:No(0),y:No(0),z:No(0)),scale:No(1)),((34)):Simple(offset:(-2,0,2),scale:1,rotate:(0,0,0),mirror:(false,false,false)),((35)):Simple(offset:(1,0,0.5),scale:1,rotate:(4.71238898038469,0,0),mirror:(false,false,false)),((0)):Simple(offset:(0,0,0),scale:1,rotate:(0,0,0),mirror:(false,false,false))})),use_time:true)